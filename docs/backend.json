{
  "entities": {
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator within the Class Managment application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Admin entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the administrator."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the administrator."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the administrator."
        },
        "role": {
          "type": "string",
          "description": "Role of the admin user within the system (e.g., super_admin, admin)."
        }
      },
      "required": [
        "id",
        "username",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user who can mark attendance within the Class Managment application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "role": {
          "type": "string",
          "enum": [
            "user"
          ]
        },
        "permissions": {
          "type": "object",
          "properties": {
            "canMarkAttendance": {
              "type": "boolean"
            },
            "canViewRecords": {
              "type": "boolean"
            },
            "canViewDashboard": {
              "type": "boolean"
            }
          }
        }
      },
      "required": [
        "id",
        "username",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student within the Class Managment application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity."
        },
        "rollNo": {
          "type": "string",
          "description": "Unique roll number for student login, derived from email."
        },
        "password": {
          "type": "string",
          "description": "Student's password for login. Should be stored securely."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the student."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the student."
        },
        "email": {
          "type": "string",
          "description": "Email address of the student.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "rollNo",
        "password",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course within the Class Managment application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "courseName": {
          "type": "string",
          "description": "Name of the course."
        },
        "courseCode": {
          "type": "string",
          "description": "Course code."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        }
      },
      "required": [
        "id",
        "courseName",
        "courseCode",
        "description"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AttendanceRecord",
      "type": "object",
      "description": "Represents an attendance record for a student in a course on a specific date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AttendanceRecord entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N AttendanceRecord)"
        },
        "studentRollNo": {
          "type": "string",
          "description": "The unique login roll number of the student."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N AttendanceRecord)"
        },
        "date": {
          "type": "string",
          "description": "Date of the attendance record.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": ["present", "absent"]
        },
        "markedBy": {
          "$ref": "#/backend/entities/User"
        }
      },
      "required": [
        "id",
        "studentId",
        "studentRollNo",
        "courseId",
        "date",
        "status",
        "markedBy"
      ]
    },
    "CourseStudent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CourseStudent",
      "type": "object",
      "description": "Represents the relationship between courses and students (many-to-many).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CourseStudent entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course N:N Student)"
        },
        "studentId": {
          "$ref": "#/backend/entities/Student"
        }
      },
      "required": [
        "id",
        "courseId",
        "studentId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores administrator profiles. Authorization is determined by the existence of a document in this collection.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles for users allowed to mark attendence. Authorization is determined by the existence of a document in this collection.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student profiles. Accessible and managed by admins.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Accessible and managed by admins.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/students/{studentId}",
        "definition": {
          "entityName": "CourseStudent",
          "schema": {
            "$ref": "#/backend/entities/CourseStudent"
          },
          "description": "Represents the enrollment of a student in a course. Includes denormalized student information for Authorization Independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "studentId",
              "description": "The unique identifier of the student enrolled in the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/attendance_records/{attendanceRecordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores attendance records for a specific course. Inherits 'courseId' from its parent for secure list operations and rule simplification.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "attendanceRecordId",
              "description": "The unique identifier of the attendance record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Class Managment application's requirements, focusing on admin-managed courses, student enrollment, attendance tracking, and user roles. Authorization Independence is achieved by storing roles in dedicated collections and denormalizing course membership to simplify security rules and enable secure list operations (QAPs).  Storing roles in the database allows for flexible role management without custom claims. The structure leverages path-based ownership and membership maps for collaborative data access.\n\nSpecifically:\n\n*   `/admins/{adminId}`: Stores admin user data. Authentication is handled by Firebase Auth, and authorization is determined by the existence of a document in this collection.\n*   `/users/{userId}`: Stores general user data (those who can mark attendance). Similar to admins, authorization relies on document existence.\n*   `/students/{studentId}`: Stores student data. Admins manage this data.\n*   `/courses/{courseId}`: Stores course information. Admins manage courses.\n*   `/courses/{courseId}/students/{studentId}`: Represents the many-to-many relationship between courses and students. This subcollection includes denormalized data (student IDs) from the parent `course` document, ensuring Authorization Independence for attendance records.\n*   `/courses/{courseId}/attendance_records/{attendanceRecordId}`: Stores attendance records for each course. This subcollection directly inherits the `courseId` from its parent, facilitating secure `list` operations and simplifying rules.\n\nThis structure supports the core features of the application, including class management, bulk student upload, attendance marking, report generation, and attendance percentage calculation, while adhering to the principles of Authorization Independence and DBAC."
  }
}
